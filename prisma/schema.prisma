// schema.prisma

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql" // Bisa diganti "postgresql" jika pakai Postgres
}


// --- ENUMS ---
enum Role {
  ADMIN
  COMPANY
  APPLICANT
}

enum AuthProvider {
  GOOGLE
  FACEBOOK
  TWITTER
}

enum Gender {
  L
  P
}

enum ApplicationStatus {
  PENDING
  INTERVIEW
  ACCEPTED
  REJECTED
}

// --- MODELS ---

model User {
  // Primary Key diubah jadi "id"
  id                Int       @id @default(autoincrement()) @map("user_id")
  
  email             String    @unique
  password          String?
  role              Role      @default(APPLICANT)

  provider          AuthProvider? @map("provider")
  providerAccountId String?       @map("provider_account_id")

  emailVerifiedAt   DateTime? @map("email_verified_at")
  verificationToken String?   @map("verification_token")
  tokenExpiresAt    DateTime? @map("token_expires_at")

  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Relations
  applicantProfile  ApplicantProfile?
  companyProfile    CompanyProfile?
  applications      Application[]
  savedJobs         SavedJob[]

  @@map("users")
}

model ApplicantProfile {
  // Primary Key diubah jadi "id"
  id              Int       @id @default(autoincrement()) @map("applicant_id")
  
  // FK tetap userId, tapi referensinya ke User.id
  userId          Int       @unique @map("user_id") 
  
  name            String
  gender          Gender
  dob             DateTime  @db.Date
  phone           String
  address         String    @db.Text
  lastEducation   String    @map("last_education")
  photoPath       String?   @map("photo_path")
  cvResumePath    String?   @map("cv_resume_path")

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("applicant_profiles")
}

model CompanyProfile {
  // Primary Key diubah jadi "id"
  id              Int       @id @default(autoincrement()) @map("company_id")
  
  // FK tetap userId
  userId          Int       @unique @map("user_id")
  
  companyName     String    @map("company_name")
  description     String    @db.Text
  logoPath        String?   @map("logo_path")
  websiteUrl      String?   @map("website_url")
  industry        String
  location        String

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobPostings     JobPosting[]

  @@map("company_profiles")
}

model JobPosting {
  // Primary Key diubah jadi "id"
  id                Int       @id @default(autoincrement()) @map("job_posting_id")
  
  // FK tetap companyId
  companyId         Int       @map("company_id") 
  
  title             String
  category          String
  location          String
  salaryMin         Decimal   @map("salary_min") @db.Decimal(15, 2)
  salaryMax         Decimal   @map("salary_max") @db.Decimal(15, 2)
  description       String    @db.Text
  hasPreselection   Boolean   @default(false) @map("has_preselection_test")
  isPublished       Boolean   @default(true) @map("is_published")
  postedAt          DateTime  @default(now()) @map("posted_at")
  deadlineAt        DateTime  @map("deadline_at")

  // Relations
  company           CompanyProfile @relation(fields: [companyId], references: [id], onDelete: Cascade)
  applications      Application[]
  questions         PreselectionQuestion[]
  savedByUsers      SavedJob[]

  @@map("job_postings")
}

model PreselectionQuestion {
  // Primary Key diubah jadi "id"
  id            Int         @id @default(autoincrement()) @map("question_id")
  
  jobPostingId  Int         @map("job_posting_id")
  
  questionText  String      @map("question_text") @db.Text
  options       Json        
  correctAnswer String      @map("correct_answer") @db.Char(1)

  // Relations
  jobPosting    JobPosting  @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)

  @@map("preselection_questions")
}

model Application {
  // Primary Key diubah jadi "id"
  id                Int       @id @default(autoincrement()) @map("applications_id")
  
  userId            Int       @map("user_id") 
  jobPostingId      Int       @map("job_posting_id")
  
  cvFilePath        String    @map("cv_file_path")
  expectedSalary    Decimal   @map("expected_salary") @db.Decimal(15, 2)
  preselectionScore Int?      @map("preselection_score")
  status            ApplicationStatus @default(PENDING)
  rejectionReason   String?   @map("rejection_reason") @db.Text
  appliedAt         DateTime  @default(now()) @map("applied_at")

  // Relations
  applicant         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobPosting        JobPosting @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)
  interviews        Interview[]

  @@map("applications")
}

model Interview {
  // Primary Key diubah jadi "id"
  id            Int       @id @default(autoincrement()) @map("interview_id")
  
  applicationId Int       @map("application_id")
  
  scheduledAt   DateTime  @map("scheduled_at")
  locationLink  String    @map("location_link") 
  notes         String?   @db.Text
  isReminded    Boolean   @default(false) @map("is_reminded")

  // Relations
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@map("interviews")
}

model SavedJob {
  // Primary Key sudah "id" (tidak perlu diubah)
  id            Int       @id @default(autoincrement())
  
  userId        Int       @map("user_id")
  jobPostingId  Int       @map("job_posting_id")
  createdAt     DateTime  @default(now()) @map("created_at")

  // Relations
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobPosting    JobPosting @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)

  @@map("saved_jobs")
}